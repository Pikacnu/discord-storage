<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div class="w-full h-svh dark:bg-black dark:text-white p-4 flex flex-col justify-center items-center">
    <div id="preview"
      class="*:max-w-[32rem] *:max-h-[18rem] *:border flex flex-row *:p-4 m-2 items-center justify-center">

    </div>
    <div id="result" class="">

    </div>
  </div>
  <script>
    let path = window.location.pathname.split('/');
    path.pop();
    let id = path.pop();
    let filename = path.pop();
    console.log(`${window.location.host}/attachments/${id}/${filename}`)
    (async () => {
      const fileReq = await fetch(`${window.location.host}/attachments/${id}/${filename}`)
      if (fileReq.status === 404) {
        document.getElementById('result').innerHTML = 'File not found';
        return;
      }
      const downloadButton = document.createElement('a');
      downloadButton.href = `${window.location.host}/attachments/${id}/${filename}`;
      const file = await fileReq.blob();
      const url = URL.createObjectURL(file);
      if (file.type.includes('image')) {
        const img = document.createElement('img');
        img.src = url;
        document.getElementById('preview').appendChild(img);
      } else if (file.type.includes('video')) {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        document.getElementById('preview').appendChild(video);
      } else if (file.type.includes('audio')) {
        const audio = document.createElement('audio');
        audio.src = url;
        audio.controls = true;
        document.getElementById('preview').appendChild(audio);
      } else {
        const p = document.createElement('p');
        p.innerHTML = filename;
        document.getElementById('preview').appendChild(p);
      }
    })();
  </script>
</body>

</html>